<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('商店信息')" />
    <style type="text/css">
    	.mark{
	    margin-top:0px;
	    margin-right:0px;
	    margin-bottom:0px;
	    margin-left:0px;
/* 		overflow:auto; */
		background-color: black;
		text-align:center;
		opacity: 0.5;
		background-position:top;
	}
    </style>
</head>
<body class="gray-bg">
<div class="col-sm-12">
		<div class="tabs-container">
			<ul class="nav nav-tabs">
				<li class="active">
					<a data-toggle="tab" href="#tab-1" aria-expanded="true">已存系统</a>
				</li>
				<li class="">
					<a data-toggle="tab" href="#tab-2" aria-expanded="false">新查找</a>
				 </li>
			</ul>
			<div class="tab-content">
				<div id="tab-1" class="tab-pane active">
					<div class="panel-body">
						  <div class="container-div">
					        <div class="row">
					            <div class="col-sm-12 search-collapse">
					                <form id="shopInfoForm">
					                    <div class="select-list">
					                        <ul>
					                            <li>
					                                <p>店名：</p>
					                                <input type="text" name="shopName" />
					                            </li>
					                            <li>
					                                <p>联系方式：</p>
					                                <input type="text" name="phone"/>
					                            </li>
					                             <li>
					                                <p>地址：</p>
					                                <input type="text" name="adress"/>
					                            </li>
					                             <li>
					                                <p>来源：</p>
					                                <select name="os">
					                                	<option value="">所有</option>
					                                    <option value="MT">美团</option>
<!-- 					                                    <option value="BD">百度</option> -->
					                                    <option value="DZDP">大众点评</option>
					                                </select>
					                            </li>
					                            <li>
					                            	 <a class="btn btn-success" onclick="$.table.search()"  >
									                    <i class="fa fa-search"></i> 查询
									                </a>
					                            </li>
					                        </ul>
					                     </div>
					                  </form>
					               </div>
<!-- 					               <div  class="btn-group-sm" id="toolbar" role="group"> -->
						               
<!-- 						            </div>   -->
									<div class="col-sm-12 select-table table-striped">
										<table id="list-table"></table>
									</div>
					         </div>
					     </div>
					</div>
				</div>
				<div id="tab-2" class="tab-pane">
				     <div class="panel-body">
				     		<div class="container-div">
						        <div class="row">
						            <div class="col-sm-12 search-collapse">
						                <form id="searchForm">
						                    <div class="select-list">
						                        <ul>
						                            <li>
						                                <p>关键词：</p>
						                                <select name="keyword">
						                                    <option value="美容院">美容院</option>
						                                </select>
						                            </li>
						                             <li>
						                                <p>来源：</p>
						                                <select name="os">
						                                	<option value="">所有</option>
						                                    <option value="MT" selected>美团</option>
<!-- 						                                    <option value="BD">百度</option> -->
						                                    <option value="DZDP">大众点评</option>
						                                </select>
						                            </li>
						                            <li style="width: 350px;">
						                                <p>城市：</p>
						                                <div data-toggle="distpicker">
									                          <select name="province" style="display: inline-block;width: 100px;"></select>
									                          <select name="city"  style="display: inline-block;width: 100px;"></select>
<!-- 									                          <select name="area"></select> -->
								                         </div>
<!-- 						                                <input type="hidden" name="city" value="guangzhou"/> -->
						                            </li>
						                            <li>
						                            	 <a class="btn btn-success" id="btn-search"  >
										                    <i class="fa fa-search"></i> 获取
										                </a>
						                            </li>
						                        </ul>
						                     </div>
						                  </form>
						               </div>
<!-- 						               <div  class="btn-group-sm" id="toolbar" role="group"> -->
							               
<!-- 							            </div> -->
						               <div class="col-sm-12 select-table table-striped">
						               	<div id="scrollTable" style="max-height: 350px; width:100%; margin: auto;min-height:10px;overflow: auto;position: relative;">
											<table id="search-table" class="table table-bordered table-striped" style="margin-bottom: 0px;">
									              <tbody id="search-tbody">
									              	<tr>
									              		<td  colspan="6" style="text-align: center;" >无记录</td>
									              	</tr>
												  </tbody>
									              <thead>
												    <tr>
												      <th>商家</th>
												      <th>联系方式</th>
												      <th>地址</th>
												      <th>品类</th>
												      <th>来源</th>
												      <th>访问链接</th>
												    </tr>
												  </thead>
								             </table>
										</div>
										<div style="background: #eff3f8;width: 100%;height: 35px;">
											<div style="float: left;position: relative;top:5px;">
												<span>第<input type="number" name="page" onchange="javascript:pageChange();" value="1" min="1" style="text-align:center; width: 35px;height: 30px;border: 1px solid #ddd;border-radius: 4px;" form="searchForm" />页</span>&nbsp;
												<span>显示<select name="limit" onchange="javascript:pageChange();" style="border: 1px solid #ddd;border-radius: 4px;  background: width;  outline: none;width: 50px;height: 32px;" form="searchForm" >
															<option value="10" selected="selected">10</option>
															<option value="100" >100</option>
															<option value="500">500</option>
															<option value="1000">1000</option>
														 </select>条</span>     
											</div>
											<div style="float: right;position: relative;top:3px;">
												<span><a class="btn btn-default btn-sm" href="javascript:void(0);" onclick="javascript:pageOperate('first');">首页</a></span>
												<span><a class="btn btn-default btn-sm" href="javascript:void(0);" onclick="javascript:pageOperate('last');">上一页</a></span>
												<span><a  class="btn btn-default btn-sm" href="javascript:void(0);" onclick="javascript:pageOperate('netx');">下一页</a></span>
											</div>
										</div>
										</div>
									 </div>
							</div>
				      </div>
				</div>
			</div>


		</div>
	</div>
    <th:block th:include="include :: footer" />
     <th:block th:include="include :: distpicker-js" />
    <script th:inline="javascript">
    var prefix = ctx + "wxcustomer/shopInfo";
    $(function() {
    var options = {
        	id: "list-table",
        	toolbar: "toolbar1",
            url: prefix + "/list",
	        showSearch: false,
	        showRefresh: false,
	        showToggle: false,
	        showColumns: false,
            columns: [{
	            checkbox: false
	        },
			{
				field : 'shopName', 
				title : '商家',
			},
			{
				field : 'phone', 
				title : '联系方式',
			},
			{
				field : 'adress', 
				title : '地址',
			},
			{
				field : 'classic', 
				title : '品类',
			},
			{
				field : 'os', 
				title : '来源',
			},
			{
				field : 'link', 
				title : '访问链接',
			},
			]
        };
        $.table.init(options);
       
        function GetTips(msg){
        	return "<tr>"+
					"<td  colspan='6' style='text-align: center;' >"+msg+"</td>"+
				"</tr>";
        };
        $("#btn-search").click(function(){
        	var city=$('[name="city"]').val();
        	if(!city){
        		$.modal.alertWarning('请选择城市！')
        		return;
        	}
        	$("#search-tbody").empty();
        	$("#search-tbody").addClass("mark").append(GetTips('正在获取中'));
        	var url=prefix + "/search";
        	var param=$("#searchForm").serialize();
        	
        	jQuery.post(url,param,function(res){
        		$("#search-tbody").empty().removeClass("mark");
        		if(res.length<1){
        			$("#search-tbody").append(GetTips('无记录'));
        		}
        		for(var i=0;i<res.length;i++){
        			var result=res[i];
        			var elem="<tr>"+
        						"<td>"+result.shopName+"</td>"+
        						"<td>"+result.phone+"</td>"+
        						"<td>"+result.adress+"</td>"+
        						"<td>"+result.classic+"</td>"+
        						"<td>"+GetOs(result.os)+"</td>"+
        						"<td>"+result.link+"</td>"+
        					"</tr>";
        			$("#search-tbody").append(elem);
        		}
        	},"JSON").error(function() { 
        		$("#search-tbody").empty().append(GetTips('无记录,可能IP被封了'));
        	})
        });
    });
    //来源
    function GetOs(type){
    	if(type=="MT"){
    		return "美团";
    	}else if(type=="BD"){
    		return "百度地图";
    	}else if(type=="DZ"){
    		return "大众点评";
    	}else{
    		return "";
    	}
    }
    function pageChange(){
    	$("#btn-search").click();
    }
    //翻页操作
    function pageOperate(type){
    	var ogri=Number($("[name='page']").val());
    	var page=1;
    	if(type=="last"){
    		if(ogri>1){
    			page=(ogri-page);
    		}
    	}else if(type=="next"){
    		page=(ogri+page);
    	}else if(type=="first"){
    		page=1;
    	}
    	$("[name='page']").val(page);
    	$("#btn-search").click();
    }
    $('#customerAddressSelect').distpicker({
		  province: $('#provinceData').text(),
		  city: $('#provinceData').text(),
		  district: $('#provinceData').text()
		});
    //table fixed
    var scrollTopVal = 0;
	var scrollLeftVal = 0;
    var scrollTable = document.querySelector('#scrollTable');
	$("#scrollTable").scroll(function() {
		scrollHandle(scrollTable,"search-table","th:eq(0),th:eq(1)","");
	});
	function scrollHandle($this,tableId,fixedColumnTh,fixedColumnTd) {
		var scrollTop = $this.scrollTop;
		var scrollLeft = $this.scrollLeft;
		if (scrollLeftVal != scrollLeft) {//左右滚动
			scrollLeftVal = scrollLeft
			$('#' + tableId + ' tbody tr').find(fixedColumnTd).css({
				"transform" : 'translateX(' + scrollLeft + 'px)',
			});
			$('#' + tableId + ' thead tr').find(fixedColumnTh).css({
				"transform" : "translateX(" + scrollLeft + "px)",
				"background" : "#37a5e1",
			});

		}
		if (scrollTopVal != scrollTop) {//上下滚动
			scrollTopVal = scrollTop
			$('#' + tableId + ' thead').css({
				"transform" : 'translateY(' + scrollTop + 'px)',
			});
		}
	}
    </script>
    
</body>
</html>